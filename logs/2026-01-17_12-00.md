# Session: 2026-01-17
**Context:** logs/ (root)
**Goal:** Implement workflow rules improvements and project setup

## Tasks
- Add Session Start + Every Turn checklists
- Add git branching table
- Reorder sections
- Clarify logs vs plan distinction

## Thinking
Starting with the workflow.mdc restructure. Need to:
1. Add checklists at top
2. Reorder sections (checklists → lifecycle → git → context engineering → planning → learning)
3. Clarify log vs plan in context engineering section

Will read current file first, then rewrite with new structure.

## Done
Rewrote workflow.mdc with:
- Session Start Checklist (3 items)
- Every Turn Checklist (4 items with "ask human" triggers)
- Two Artifacts table (logs vs plan)
- Git Branching table (quick task vs story)
- Reordered: Checklists → Lifecycle → Git → Context Eng → Planning → Learning
- Clarified logs as scratchpad for context offloading

## New Task: Add ruff linting
- Add ruff to dev deps
- Configure ruff in pyproject.toml
- Update python-stack.mdc rules to mention ruff

Done:
- Added ruff>=0.9 to dev deps
- Configured [tool.ruff] with sensible defaults (E, W, F, I, UP, B, SIM, RUF)
- Added Linting & Formatting section to python-stack.mdc
- Fixed 6 lint issues in skill-creator scripts

## Expand .active as session state file

User wants `.active` to track:
- context (root or story-name)
- files touched this session

Added hooks:
- `file-guard.sh` (beforeReadFile) — enforces log access to current context
- `track-files.sh` (afterFileEdit) — tracks project files edited

Updated format:
```yaml
context: root
files:
  - src/foo.py
```

User correction: IMPLEMENTATION_PLAN.md is also stateful but cross-agent.
Need to clarify in workflow rules:
- `.active` = this agent's session state
- `IMPLEMENTATION_PLAN.md` = cross-agent source of truth

Done: Updated workflow rules with two-level state table.

## Add warning about touching other agents' stories

User wants obvious warning. Added:
- Warning block with ⚠️ about never modifying other agents' stories
- Clarified "your story" = matches context in .active
- Root context rules: can add new stories, read any, but not modify existing

## Plan guard hook + sync on session start

User refinement:
- Root CAN modify unassigned (planned) stories without permission
- Root needs permission for assigned/in-progress stories
- Session start should PULL IMPLEMENTATION_PLAN.md from master first

Added:
- `plan-guard.sh` (beforeFileEdit) — checks story ownership
- Updated `session-start.sh` to fetch + checkout IMPLEMENTATION_PLAN.md from origin/master
- Updated workflow rules with sync behavior details
